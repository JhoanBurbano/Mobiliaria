{"ast":null,"code":"import _asyncToGenerator from \"/media/jhoanburbano/ubuntu-data/jhoanburbano/projects/angular/Architect/_client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nlet MyAccountComponent = class MyAccountComponent {\n  constructor(sanitizer, profileS, toast, router, fb) {\n    var _this = this;\n\n    this.sanitizer = sanitizer;\n    this.profileS = profileS;\n    this.toast = toast;\n    this.router = router;\n    this.fb = fb;\n    this.urlImg = null;\n    this.datos = {};\n    this.isEdit = false;\n    this.nProfile = null;\n\n    this.extraerBase64 = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* ($event) {\n        return new Promise(resolve => {\n          try {\n            const unsafeImg = window.URL.createObjectURL($event);\n\n            const image = _this.sanitizer.bypassSecurityTrustUrl(unsafeImg);\n\n            const reader = new FileReader();\n            reader.readAsDataURL($event);\n\n            reader.onload = () => {\n              resolve({\n                base: reader.result\n              });\n            };\n\n            reader.onerror = error => {\n              resolve({\n                base: null\n              });\n            };\n          } catch (e) {\n            return null;\n          }\n        });\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    this.editUserForm = this.fb.group({\n      name: ['', Validators.required],\n      lastname: ['', Validators.required],\n      email: ['', Validators.required],\n      password: ['', [Validators.required, Validators.pattern(/^(?=.*\\d)(?=.*[!@#$.%^&*])(?=.*[a-z])(?=.*[A-Z]).{8,16}$/)]],\n      rol: ['', Validators.required],\n      number: ['', Validators.required],\n      desc: ['']\n    });\n  }\n\n  ngOnInit() {\n    this.obtenerProfile();\n  }\n\n  crearForm(data) {\n    this.editUserForm.controls['name'].setValue(this.datos.name);\n    this.editUserForm.controls['lastname'].setValue(this.datos.lastname);\n    this.editUserForm.controls['email'].setValue(this.datos.email);\n    this.editUserForm.controls['rol'].setValue(this.datos.rol);\n    this.editUserForm.controls['number'].setValue(this.datos.number);\n    this.editUserForm.controls['desc'].setValue(this.datos.desc);\n    this.editUserForm.controls['password'].setValue(`.0DebesCambiar0.`);\n  }\n\n  obtenerProfile() {\n    this.profileS.getData(true).subscribe(data => {\n      this.datos = data.user;\n      this.crearForm(data);\n      this.UFO = data.user.password;\n      this.urlImg = data.user.profile;\n      this.id = data.user.id;\n    }, err => {});\n  }\n\n  touchEditar(event) {\n    event.preventDefault();\n    this.isEdit = true;\n    this.toast.info('ahora estas editando tu perfil', 'Editar Activated');\n  }\n\n  captarProfile(event) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      let ext;\n\n      if (event.target.files[0].name.indexOf('.jpg') > 0 || event.target.files[0].name.indexOf('.png') > 0) {\n        ext = event.target.files[0].name.slice(event.target.files[0].name.length - 4, event.target.files[0].name.length);\n      } else {\n        ext = event.target.files[0].name.slice(event.target.files[0].name.length - 5, event.target.files[0].name.length);\n      }\n\n      _this2.nameFile = `${_this2.id}_profile${ext}`;\n      let img = yield _this2.extraerBase64(event.target.files[0]);\n      let base = img.base;\n      let data = yield _this2.getImageDimensions(base);\n\n      if (data.w <= data.h * 1.16) {\n        _this2.nProfile = base;\n        _this2.Profile = event.target.files[0];\n\n        if (data.w > data.h) {\n          _this2.classImg = `transform: scale(1.2)`;\n        } else if (data.w <= data.h) {\n          _this2.classImg = 'width: 12rem;';\n        }\n      } else {\n        _this2.toast.show('La imagen debe tener una relacion de aspecto proporcional 1:1, recortela o elija otra', 'DIMENSION NO PERMITIDA');\n      }\n    })();\n  }\n\n  noImage() {\n    this.nProfile = null;\n    this.Profile = null;\n  }\n\n  getImageDimensions(file) {\n    return new Promise(function (resolved, rejected) {\n      var i = new Image();\n\n      i.onload = function () {\n        resolved({\n          w: i.width,\n          h: i.height\n        });\n      };\n\n      i.src = file;\n    });\n  }\n\n  actualizarPerfil(event) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b, _c, _d, _e, _f;\n\n      event.preventDefault();\n\n      if (_this3.editUserForm.valid) {\n        if (_this3.Profile) {\n          try {\n            let formData = new FormData();\n            formData.append('file', _this3.Profile);\n\n            _this3.profileS.postImg(formData, _this3.nameFile).subscribe(data => {\n              var _a, _b, _c, _d, _e, _f;\n\n              console.log('data -------->', data);\n              _this3.urlImg = data;\n              console.log('------------------>', _this3.urlImg);\n              let password;\n\n              if (((_a = _this3.editUserForm.get('password')) === null || _a === void 0 ? void 0 : _a.value) === '.0DebesCambiar0.') {\n                password = _this3.UFO;\n              }\n\n              const newUser = {\n                img: _this3.urlImg,\n                name: (_b = _this3.editUserForm.get('name')) === null || _b === void 0 ? void 0 : _b.value,\n                lastname: (_c = _this3.editUserForm.get('lastname')) === null || _c === void 0 ? void 0 : _c.value,\n                rol: (_d = _this3.editUserForm.get('rol')) === null || _d === void 0 ? void 0 : _d.value,\n                number: (_e = _this3.editUserForm.get('number')) === null || _e === void 0 ? void 0 : _e.value,\n                email: (_f = _this3.editUserForm.get('email')) === null || _f === void 0 ? void 0 : _f.value,\n                password: password\n              };\n              console.log(newUser);\n\n              _this3.profileS.updateProfile(newUser, _this3.id).subscribe(data => {\n                location.reload();\n\n                _this3.toast.success('Prefil actualizado', 'DONE');\n\n                _this3.router.navigate(['/profile']);\n              }, err => {\n                _this3.toast.error(err.message, err.name);\n              });\n            }, error => {\n              _this3.toast.error(error.message, error.name);\n\n              console.log(error);\n            });\n          } catch (error) {\n            _this3.toast.error('error del try', 'Error');\n\n            console.log('error del try', error);\n          }\n        }\n      } else {\n        console.log('------------------>', _this3.urlImg);\n        let password;\n\n        if (((_a = _this3.editUserForm.get('password')) === null || _a === void 0 ? void 0 : _a.value) === '.0DebesCambiar0.') {\n          password = _this3.UFO;\n        }\n\n        const newUser = {\n          img: _this3.urlImg,\n          name: (_b = _this3.editUserForm.get('name')) === null || _b === void 0 ? void 0 : _b.value,\n          lastname: (_c = _this3.editUserForm.get('lastname')) === null || _c === void 0 ? void 0 : _c.value,\n          rol: (_d = _this3.editUserForm.get('rol')) === null || _d === void 0 ? void 0 : _d.value,\n          number: (_e = _this3.editUserForm.get('number')) === null || _e === void 0 ? void 0 : _e.value,\n          email: (_f = _this3.editUserForm.get('email')) === null || _f === void 0 ? void 0 : _f.value,\n          password: password\n        };\n        console.log(newUser);\n\n        _this3.profileS.updateProfile(newUser, _this3.id).subscribe(data => {\n          location.reload();\n\n          _this3.toast.success('Prefil actualizado', 'DONE');\n        }, err => {\n          _this3.toast.error(err.message, err.name);\n        });\n      }\n    })();\n  }\n\n};\nMyAccountComponent = __decorate([Component({\n  selector: 'app-my-account',\n  templateUrl: './my-account.component.html',\n  styleUrls: ['./my-account.component.scss']\n})], MyAccountComponent);\nexport { MyAccountComponent };","map":{"version":3,"sources":["/media/jhoanburbano/ubuntu-data/jhoanburbano/projects/angular/Architect/_client/src/app/profile/components/my-account/my-account.component.ts"],"names":["__decorate","Component","Validators","MyAccountComponent","constructor","sanitizer","profileS","toast","router","fb","urlImg","datos","isEdit","nProfile","extraerBase64","$event","Promise","resolve","unsafeImg","window","URL","createObjectURL","image","bypassSecurityTrustUrl","reader","FileReader","readAsDataURL","onload","base","result","onerror","error","e","editUserForm","group","name","required","lastname","email","password","pattern","rol","number","desc","ngOnInit","obtenerProfile","crearForm","data","controls","setValue","getData","subscribe","user","UFO","profile","id","err","touchEditar","event","preventDefault","info","captarProfile","ext","target","files","indexOf","slice","length","nameFile","img","getImageDimensions","w","h","Profile","classImg","show","noImage","file","resolved","rejected","i","Image","width","height","src","actualizarPerfil","_a","_b","_c","_d","_e","_f","valid","formData","FormData","append","postImg","console","log","get","value","newUser","updateProfile","location","reload","success","navigate","message","selector","templateUrl","styleUrls"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nlet MyAccountComponent = class MyAccountComponent {\n    constructor(sanitizer, profileS, toast, router, fb) {\n        this.sanitizer = sanitizer;\n        this.profileS = profileS;\n        this.toast = toast;\n        this.router = router;\n        this.fb = fb;\n        this.urlImg = null;\n        this.datos = {};\n        this.isEdit = false;\n        this.nProfile = null;\n        this.extraerBase64 = async ($event) => new Promise((resolve) => {\n            try {\n                const unsafeImg = window.URL.createObjectURL($event);\n                const image = this.sanitizer.bypassSecurityTrustUrl(unsafeImg);\n                const reader = new FileReader();\n                reader.readAsDataURL($event);\n                reader.onload = () => {\n                    resolve({\n                        base: reader.result\n                    });\n                };\n                reader.onerror = error => {\n                    resolve({\n                        base: null\n                    });\n                };\n            }\n            catch (e) {\n                return null;\n            }\n        });\n        this.editUserForm = this.fb.group({\n            name: ['', Validators.required],\n            lastname: ['', Validators.required],\n            email: ['', Validators.required],\n            password: ['',\n                [\n                    Validators.required,\n                    Validators.pattern(/^(?=.*\\d)(?=.*[!@#$.%^&*])(?=.*[a-z])(?=.*[A-Z]).{8,16}$/)\n                ]],\n            rol: ['', Validators.required],\n            number: ['', Validators.required],\n            desc: ['',],\n        });\n    }\n    ngOnInit() {\n        this.obtenerProfile();\n    }\n    crearForm(data) {\n        this.editUserForm.controls['name'].setValue(this.datos.name);\n        this.editUserForm.controls['lastname'].setValue(this.datos.lastname);\n        this.editUserForm.controls['email'].setValue(this.datos.email);\n        this.editUserForm.controls['rol'].setValue(this.datos.rol);\n        this.editUserForm.controls['number'].setValue(this.datos.number);\n        this.editUserForm.controls['desc'].setValue(this.datos.desc);\n        this.editUserForm.controls['password'].setValue(`.0DebesCambiar0.`);\n    }\n    obtenerProfile() {\n        this.profileS.getData(true).subscribe(data => {\n            this.datos = data.user;\n            this.crearForm(data);\n            this.UFO = data.user.password;\n            this.urlImg = data.user.profile;\n            this.id = data.user.id;\n        }, err => {\n        });\n    }\n    touchEditar(event) {\n        event.preventDefault();\n        this.isEdit = true;\n        this.toast.info('ahora estas editando tu perfil', 'Editar Activated');\n    }\n    async captarProfile(event) {\n        let ext;\n        if ((event.target.files[0].name.indexOf('.jpg') > 0) || (event.target.files[0].name.indexOf('.png') > 0)) {\n            ext = event.target.files[0].name.slice(event.target.files[0].name.length - 4, event.target.files[0].name.length);\n        }\n        else {\n            ext = event.target.files[0].name.slice(event.target.files[0].name.length - 5, event.target.files[0].name.length);\n        }\n        this.nameFile = `${this.id}_profile${ext}`;\n        let img = await this.extraerBase64(event.target.files[0]);\n        let base = img.base;\n        let data = await this.getImageDimensions(base);\n        if (data.w <= (data.h * 1.16)) {\n            this.nProfile = base;\n            this.Profile = event.target.files[0];\n            if (data.w > data.h) {\n                this.classImg = `transform: scale(1.2)`;\n            }\n            else if (data.w <= data.h) {\n                this.classImg = 'width: 12rem;';\n            }\n        }\n        else {\n            this.toast.show('La imagen debe tener una relacion de aspecto proporcional 1:1, recortela o elija otra', 'DIMENSION NO PERMITIDA');\n        }\n    }\n    noImage() {\n        this.nProfile = null;\n        this.Profile = null;\n    }\n    getImageDimensions(file) {\n        return new Promise(function (resolved, rejected) {\n            var i = new Image();\n            i.onload = function () {\n                resolved({ w: i.width, h: i.height });\n            };\n            i.src = file;\n        });\n    }\n    async actualizarPerfil(event) {\n        var _a, _b, _c, _d, _e, _f;\n        event.preventDefault();\n        if (this.editUserForm.valid) {\n            if (this.Profile) {\n                try {\n                    let formData = new FormData();\n                    formData.append('file', this.Profile);\n                    this.profileS.postImg(formData, this.nameFile).subscribe((data) => {\n                        var _a, _b, _c, _d, _e, _f;\n                        console.log('data -------->', data);\n                        this.urlImg = data;\n                        console.log('------------------>', this.urlImg);\n                        let password;\n                        if (((_a = this.editUserForm.get('password')) === null || _a === void 0 ? void 0 : _a.value) === '.0DebesCambiar0.') {\n                            password = this.UFO;\n                        }\n                        const newUser = {\n                            img: this.urlImg,\n                            name: (_b = this.editUserForm.get('name')) === null || _b === void 0 ? void 0 : _b.value,\n                            lastname: (_c = this.editUserForm.get('lastname')) === null || _c === void 0 ? void 0 : _c.value,\n                            rol: (_d = this.editUserForm.get('rol')) === null || _d === void 0 ? void 0 : _d.value,\n                            number: (_e = this.editUserForm.get('number')) === null || _e === void 0 ? void 0 : _e.value,\n                            email: (_f = this.editUserForm.get('email')) === null || _f === void 0 ? void 0 : _f.value,\n                            password: password,\n                        };\n                        console.log(newUser);\n                        this.profileS.updateProfile(newUser, this.id).subscribe(data => {\n                            location.reload();\n                            this.toast.success('Prefil actualizado', 'DONE');\n                            this.router.navigate(['/profile']);\n                        }, err => {\n                            this.toast.error(err.message, err.name);\n                        });\n                    }, (error) => {\n                        this.toast.error(error.message, error.name);\n                        console.log(error);\n                    });\n                }\n                catch (error) {\n                    this.toast.error('error del try', 'Error');\n                    console.log('error del try', error);\n                }\n            }\n        }\n        else {\n            console.log('------------------>', this.urlImg);\n            let password;\n            if (((_a = this.editUserForm.get('password')) === null || _a === void 0 ? void 0 : _a.value) === '.0DebesCambiar0.') {\n                password = this.UFO;\n            }\n            const newUser = {\n                img: this.urlImg,\n                name: (_b = this.editUserForm.get('name')) === null || _b === void 0 ? void 0 : _b.value,\n                lastname: (_c = this.editUserForm.get('lastname')) === null || _c === void 0 ? void 0 : _c.value,\n                rol: (_d = this.editUserForm.get('rol')) === null || _d === void 0 ? void 0 : _d.value,\n                number: (_e = this.editUserForm.get('number')) === null || _e === void 0 ? void 0 : _e.value,\n                email: (_f = this.editUserForm.get('email')) === null || _f === void 0 ? void 0 : _f.value,\n                password: password,\n            };\n            console.log(newUser);\n            this.profileS.updateProfile(newUser, this.id).subscribe(data => {\n                location.reload();\n                this.toast.success('Prefil actualizado', 'DONE');\n            }, err => {\n                this.toast.error(err.message, err.name);\n            });\n        }\n    }\n};\nMyAccountComponent = __decorate([\n    Component({\n        selector: 'app-my-account',\n        templateUrl: './my-account.component.html',\n        styleUrls: ['./my-account.component.scss']\n    })\n], MyAccountComponent);\nexport { MyAccountComponent };\n"]},"metadata":{},"sourceType":"module"}